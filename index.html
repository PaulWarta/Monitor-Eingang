<!DOCTYPE html>
<html lang="de" id="html" style="top: 0; left: 0;">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.gstatic.com"> 
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <title>Monitor Eingang</title>
    <meta http-equiv="refresh" content="1200">
    <link rel="preload" href="style.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="preconnect" href="https://fonts.gstatic.com"> 
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@700;900&display=swap" rel="stylesheet">
    <script defer src="https://code.iconify.design/1/1.0.6/iconify.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <meta name="description" content="Monitor für den Eingangsbereich der Tanzschule mit allen wichtigen Informationen">
</head>
<script defer>
    setTimeout(() => {
        console.log("Executed")
        $("#body").hide()
        setTimeout(() => {
            alert("Die Software befindet sich derzeit in der Testphase")
        }, 100);
        $("#body").remove()
        
    }, 3000); 
</script>
<body id="body" style="margin: 0;">
    <svg width="1031" height="1698" viewBox="0 0 1031 1698" fill="none" xmlns="http://www.w3.org/2000/svg">
        <g filter="url(#filter0_f)">
            <path fill-rule="evenodd" clip-rule="evenodd" d="M613.968 702.135C614.049 785.591 465.032 869.622 419.099 962.012C344.655 1111.75 460.998 1285.58 275.679 1382.57C98.2791 1475.4 36.7262 1289.93 -61.2679 1213.4C-122.738 1165.4 -182.176 1117.02 -172.274 1032.74C-161.911 944.541 -96.9527 852.002 -8.52358 764.494C118.191 639.101 254.898 464.432 418.596 448.033C582.708 431.593 613.848 580.024 613.968 702.135Z" fill="#BC29C8" fill-opacity="0.79"/>
        </g>
        <defs>
            <filter id="filter0_f" x="-690.197" y="0.557404" width="1939.91" height="1878.06" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
                <feFlood flood-opacity="0" result="BackgroundImageFix"/>
                <feBlend mode="normal" in="SourceGraphic" in2="BackgroundImageFix" result="shape"/>
                <feGaussianBlur stdDeviation="187.585" result="effect1_foregroundBlur"/>
            </filter>
        </defs>
    </svg>
    <div class="Uhrzeit">
        <h1 id="Uhrzeit"></h1>
    </div>
    <div class="Wetter">
        <h1 id="Temperature"></h1>
        <span class="iconify" data-inline="false" data-icon="" id="icon"></span>
    </div>
    <div class="Navigation">
        <h2>Schön, <br> dass Ihr <br> wieder da seid!</h2>
    </div>
    <div id="Stundenplan">
        <ul id="Stundenplancontainer"></ul>
    </div>
    <div class="News">
        <h3>
            Wenn ihr wollt, könnt Ihr <br> euch gerne hier <br> zusätzlich anmelden:
        </h3>
        <img src="Luca_QR_plain1.png" alt="Luca QR Code" id="Luca">
        <img src="./Warnapp_QR_plain1.png" alt="Corona Warn App QR Code" id="Warnapp">
    </div>
    <div class="Poster"></div>
    <script>
        let proper_hour;
        let proper_minute;
        setInterval(
            function req_time() {
            let time = new Date();
            let Uhrzeit = document.getElementById("Uhrzeit")
            console.log()
            if (parseInt(time.getHours()) < 10) {proper_hour = "0" + time.getHours().toString()} else {proper_hour = time.getHours().toString()};
            if (parseInt(time.getMinutes()) < 10) {proper_minute = "0" + time.getMinutes().toString()} else {proper_minute = time.getMinutes().toString()};
            Uhrzeit.innerText = proper_hour + ":" + proper_minute;
        }, 500);
    </script>
    <script defer>
        const icon_library = {
            "01d" : "sunny",
            "01n" : "moon",
            "02d" : "partly-cloudy-day",
            "02n" : "partly-cloudy-night",
            "03d" : "cloudy",
            "03n" : "cloudy",
            "04d" : "cloudy",
            "04n" : "cloudy",
            "09d" : "rain",
            "09n" : "rain",
            "10d" : "rain-showers-day",
            "10n" : "rain-showers-night",
            "11d" : "thunderstorm",
            "11n" : "thunderstorm",
            "13d" : "snow",
            "13n" : "snow",
            "50d" : "fog",
            "50n" : "fog"
        }
        function fetch_weather () {
            var xhttp = new XMLHttpRequest;
            xhttp.open("GET", "https://api.openweathermap.org/data/2.5/weather?q=muelheim&units=metric&appid=2e9c5036920dde9cf253e5f1581328c2", false);
            xhttp.send();
            let data = JSON.parse(xhttp.responseText);
            let ic = data.weather;
            ic = ic[0];
            ic = ic.icon;
            let url = "fluent:weather-" + icon_library[ic] + "-48-regular"
            let temp = data.main;
            temp = temp.temp;
            document.getElementById("icon").setAttribute("data-icon", url);
            document.getElementById("Temperature").innerText = Math.round(temp.toString()).toString() + "\xB0";
        }
        setInterval(fetch_weather(), 60000)
        fetch_weather();
    </script>
    <script defer>
        let xhttp = new XMLHttpRequest;
        xhttp.open("GET", "./timetable.txt", false);
        xhttp.send();
        let response = xhttp.responseText;
        let data = JSON.parse(response);
        let len = Object.keys(data).length;
        for (i = 0; i < len; i++) {
            let start = data[i]["start"];i
            let end = data[i]["end"];
            let name = data[i]["name"];
            let teacher = data[i]["teacher"];
            let room = data[i]["room"];
            let place_of_image = "/Monitor-Eingang/images/" + teacher + ".png";


            let Stundenplan = document.getElementById("Stundenplancontainer");
            let Std_container = document.createElement("li")
            Std_container.setAttribute("class", "StdContainer");
            let DescContainer = document.createElement("div"); DescContainer.setAttribute("class", "DescContainer");
            let teacher_container = document.createElement("div"); teacher_container.setAttribute("class", "teacherContainer"); teacher_container.setAttribute("style", "overflow: hidden"); 
            let teacher_image = document.createElement("img"); teacher_image.setAttribute("src", place_of_image); teacher_image.setAttribute("alt", " "); teacher_image.setAttribute("class", "teacher_image"); teacher_image.setAttribute("onerror", "this.style.display='none'"); teacher_container.appendChild(teacher_image); console.log(teacher_image)
            let zeitfenster = document.createElement("h6"); zeitfenster.setAttribute("id", i); zeitfenster.innerHTML = start + " " + end;
            Std_container.appendChild(teacher_container);
            let kurs_element = document.createElement("h4"); kurs_element.innerText = name; DescContainer.appendChild(kurs_element);
            let kurs_description = document.createElement("h5"); kurs_description.innerText = room + " - " + teacher; DescContainer.appendChild(kurs_description);
            Std_container.appendChild(DescContainer);
            Std_container.appendChild(zeitfenster);
            Stundenplan.appendChild(Std_container);
        }
    </script>
    <script defer>
        let hours;
        let minutes;
        let time_to_vanish;
        let current_element;
        let now;
        let vanish_list = [];
        let timetableLength;
        let button_pressed = 0;
        let length1;
        function CalculateTimesToVanish () {
            if (minutes > 19) {
                time_to_vanish = hours + ":" + (minutes - 10)
            }
            else if (minutes > 10) {
                time_to_vanish = hours + ":0" + (minutes - 10);
            } else if(minutes == 10) {
                time_to_vanish = hours + ":00";
            } else {
                time_to_vanish = (parseInt(hours) - 1).toString() + ":" + (parseInt(minutes) + 50).toString();
            }
        }
        function getTime () {
            now = new Date;
            if (now.getMinutes < 10) {
                minutes = "0" + now.getMinutes();
            } else {minutes = now.getMinutes()}
            if (now.getHours() < 10) {
                hours = "0" + now.getHours();
            } else {hours = now.getHours()}
        }
        function Saalbelegung () {
            getTime();
            CalculateTimesToVanish();
        }
        setInterval(() => {
            Saalbelegung();
        }, 1000);
        function move_up () {
            $("#Stundenplancontainer").animate({
                top: "-=108px"
            }, 600)
        }
        setInterval(() => {
            let time_to_vanish_int = parseInt(time_to_vanish.slice(0,2) + time_to_vanish.slice(3,5));
            timetableLength = document.getElementById("Stundenplancontainer").getElementsByTagName("li").length
            vanish_list = [];
            for (i = 0; i < timetableLength; i++) {
                let element = document.getElementById(i).innerText;
                let element_int = parseInt(element.slice(0,2) + element.slice(3,5));
                if (time_to_vanish_int >= element_int) {
                    vanish_list.push(i);
                }
                for (j = 0; j < timetableLength; j++) {
                    length1 = vanish_list.length;
                    if (button_pressed < length1) {
                        move_up();
                        button_pressed++;
                    }
                }
            }
        }, 2000);
    </script>
    <script defer>
    </script>
</body>
</html>
