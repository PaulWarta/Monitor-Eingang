<!DOCTYPE html>
<html lang="us">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.gstatic.com"> 
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <title>Document</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.gstatic.com"> 
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@700;900&display=swap" rel="stylesheet">
    <script src="https://code.iconify.design/1/1.0.6/iconify.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>
    <img src="./Blop.png">
    <div class="Uhrzeit">
        <h1 id="Uhrzeit"></h1>
    </div>
    <div class="Wetter">
        <h1 id="Temperature"></h1>
        <span class="iconify" data-inline="false" data-icon="" id="icon"></span>
    </div>
    <div class="Navigation">
        <h2>Schön, <br> dass Ihr <br> wieder da seid!</h2>
    </div>
    <div id="Stundenplan">
        <ul id="Stundenplancontainer"></ul>
    </div>
    <div class="News">
        <h3>
            Wenn ihr wollt, könnt Ihr <br> euch gerne hier <br> zusätzlich anmelden:
        </h3>
        <img src="Luca_QR_plain1.png" id="Luca">
        <img src="./Warnapp_QR_plain1.png" id="Warnapp">
    </div>
    <div class="Poster"></div>
    <script>
        setInterval(
            function req_time() {
            var time = new Date;
            if (time.getMinutes().toString() < 10) {
                if (time.getHours().toString() < 10) {
                    element = document.getElementById("Uhrzeit").innerText = "0:" +  time.getHours().toString() + ":0" + time.getMinutes().toString();
                } else {
                    element = document.getElementById("Uhrzeit").innerText = time.getHours().toString() + ":0" + time.getMinutes().toString();
                }
            } else {
                if (time.getHours().toString() < 10) {
                    element = document.getElementById("Uhrzeit").innerText = "0:" +  time.getHours().toString() + time.getMinutes().toString();
                } else {
                    element = document.getElementById("Uhrzeit").innerText = time.getHours().toString() + ":" + time.getMinutes().toString();
                }
            }
        }, 1000);
    </script>
    <script defer>
        const icon_library = {
            "01d" : "sunny",
            "01n" : "moon",
            "02d" : "partly-cloudy-day",
            "02n" : "partly-cloudy-night",
            "03d" : "cloudy",
            "03n" : "cloudy",
            "04d" : "cloudy",
            "04n" : "cloudy",
            "09d" : "rain",
            "09n" : "rain",
            "10d" : "rain-showers-day",
            "10n" : "rain-showers-night",
            "11d" : "thunderstorm",
            "11n" : "thunderstorm",
            "13d" : "snow",
            "13n" : "snow",
            "50d" : "fog",
            "50n" : "fog"
        }
        function fetch_weather () {
            var xhttp = new XMLHttpRequest;
            xhttp.open("GET", "https://api.openweathermap.org/data/2.5/weather?q=muelheim&units=metric&appid=2e9c5036920dde9cf253e5f1581328c2", false);
            xhttp.send();
            let data = JSON.parse(xhttp.responseText);
            let ic = data.weather;
            ic = ic[0];
            ic = ic.icon;
            let url = "fluent:weather-" + icon_library[ic] + "-48-regular"
            let temp = data.main;
            temp = temp.temp;
            document.getElementById("icon").setAttribute("data-icon", url);
            document.getElementById("Temperature").innerText = Math.round(temp.toString()).toString() + "\xB0";
        }
        setInterval(fetch_weather(), 60000)
        fetch_weather();
    </script>
    <script defer>
        let now1 = Date.now();
        let timestamp = Math.round(((parseInt(now1) + 120) / 1000) - 86400);
        let parameter = {
            "apikey" : "db7a5918390d7c70d3ea9bc02afa667c3147097664ad5e9ee4a772f42c7259da",
            "date" : timestamp,
            "days" : "2",
            "programOnlyNew" : "false"
        }
        let xhttp = new XMLHttpRequest;
        xhttp.open("POST", "https://tanzschule-ritter.nimbuscloud.at/api/json/v1/timetable/data", false);
        xhttp.setRequestHeader("data", parameter);
        xhttp.send();
        let response = xhttp.responseText;
        let data = JSON.parse(response);
        let len = Object.keys(data).length;
        for (i = 0; i < len; i++) {
            console.log(i);
            let start = data[i]["start"];i
            let end = data[i]["end"];
            let name = data[i]["name"];
            let teacher = data[i]["teacher"];
            let room = data[i]["room"];
            let place_of_image = "./images/" + "Luca" + ".png";

            let Stundenplan = document.getElementById("Stundenplancontainer");
            let Std_container = document.createElement("li")
            Std_container.setAttribute("class", "StdContainer");

            let DescContainer = document.createElement("div"); DescContainer.setAttribute("class", "DescContainer");
            let teacher_image = document.createElement("img"); teacher_image.setAttribute("src", place_of_image); teacher_image.setAttribute("class", "Profilbild"); 
            let zeitfenster = document.createElement("h6"); zeitfenster.setAttribute("id", i); zeitfenster.innerHTML = start + " " + end;
            Std_container.appendChild(teacher_image);
            let kurs_element = document.createElement("h4"); kurs_element.innerText = name; DescContainer.appendChild(kurs_element);
            let kurs_description = document.createElement("h5"); kurs_description.innerText = room + " - " + teacher; DescContainer.appendChild(kurs_description);
            Std_container.appendChild(DescContainer);
            Std_container.appendChild(zeitfenster);
            Stundenplan.appendChild(Std_container);
        }
    </script>
    <script defer>
        let hours;
        let minutes;
        let time_to_vanish;
        let current_element;
        let now;
        let vanish_list = [];
        let timetableLength;
        function CalculateTimesToVanish () {
            hours = "16"; minutes = "15";
            if (minutes > 20) {
                time_to_vanish = hours + ":" + (minutes - 10);
            } else {
                time_to_vanish = (hours + 1) + ":0" + ((minutes + 60) - 10);
            }
        }
        function getTime () {
            now = new Date;
            if (now.getMinutes < 10) {
                minutes = "0" + now.getMinutes();
            } else {minutes = now.getMinutes()}
            if (now.getHours() < 10) {
                hours = "0" + now.getHours();
            } else {hours = now.getHours()}
        }
        function Saalbelegung () {
            current_time = document.getElementById("Uhrzeit").innerText;
            getTime();
            CalculateTimesToVanish();
        }
        setInterval(Saalbelegung(), 1000);
        function throwElements() {
            console.log(time_to_vanish);
            timetableLength = document.getElementById("Stundenplancontainer").getElementsByTagName("li").length
            for (i = 0; i < timetableLength; i++) {
                let element = document.getElementById(i).innerText;
                if (time_to_vanish == element.slice(0,5)) {
                    vanish_list.push(i);
                    console.log("Executed")
                }
            }
        }
        setInterval(throwElements(), 2000);
    </script>
</body>
</html>